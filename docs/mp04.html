<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>mp04 – STA 9750 2024 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">

<script src="site_libs/datatables-binding-0.33/datatables.js"></script>

<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>

<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">

<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">

<script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>

<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>



</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 2024 Submission Material</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">




<section id="mini-project-04-monte-carlo-informed-selection-of-cuny-retirement-plans" class="level1" style="text-align: center;">
<h1>Mini-Project #04: Monte Carlo-Informed Selection of CUNY Retirement Plans</h1>
</section>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Newly hired at CUNY, I have thirty days to choose between one of two retirement plans. These two plans can be viewed <a href="https://www.cuny.edu/wp-content/uploads/sites/4/page-assets/about/administration/offices/hr/benefits/Benefits-Guide-Retirement-Plans-Final-HEO-and-ECP.pdf">here</a>. This is an early choice for faculty and is important as it is essentially permanent and cannot be changed. In this project, I will use historical financial data and a bootstrap inference strategy to estimate the probability that one plan is better than the other.</p>
<p>The two plans are better explained below:</p>
<section id="teachers-retirement-system-trs" class="level2">
<h2 class="anchored" data-anchor-id="teachers-retirement-system-trs">Teachers Retirement System (TRS)</h2>
<p>The TRS plan is a traditional pension plan: after retirement, the employer continues to pay employees a fraction of their salary until death. This type of plan is called a “defined-benefit” because the retirement pay is fixed a priori and the employer takes the market risk. If the market under performs expectations, CUNY has to make up the gap; if the market over performs expectations, CUNY pockets the excess balance.</p>
<p>Employees pay a fixed percentage of their paycheck into the pension fund. The contribution rates are based on employee’s salary amount, and are as follows:</p>
<ul>
<li>$45,000 or less: 3%</li>
<li>$45,001 to $55,000: 3.5%</li>
<li>$55,001 to $75,000: 4.5%</li>
<li>$75,001 to $100,000: 5.75%</li>
<li>$100,001 or more: 6%</li>
</ul>
<p>Then, the retirement benefit is calculated based on the <em>Final three years salary</em> of the employee, which changed after 2024. Before 2024, it was based on the prior five years.</p>
<p>If <strong>N</strong> is the number of years served, the annual retirement benefit is:</p>
<ul>
<li>1.67% * FAS * N, if N is less than 20 years</li>
<li>1.75% * FAS * N, if N is equal to 20 years</li>
<li>(35% + 2% * N) * FAS, if N is greater than 20 years</li>
</ul>
<p>In each case, the benefit is paid out equally over 12 months.</p>
<p>The benefit is increased annually by 50% of the CPI, rounded up to the nearest tenth of a percent. For example, a CPI of 2.9% gives an inflation adjustment of 1.5%. The benefit is capped below at 1% and above at 3%, so a CPI of 10% leads to a 3% inflation adjustment while a CPI of 0% leads to a 1% inflation adjustment.</p>
<p>The inflation adjustment is effective each September and the CPI used is the aggregate monthly CPI of the previous 12 months; so the September 2024 adjustment depends on the CPI from September 2023 to August 2024.</p>
</section>
<section id="optional-retirement-plan-orp" class="level2">
<h2 class="anchored" data-anchor-id="optional-retirement-plan-orp">Optional Retirement Plan (ORP)</h2>
<p>The ORP plan is more similar to a 401(k) plan offered by a private employer. The employee and the employer both make contributions to a retirement account which is then invested in the employee’s choice of mutual funds. Those investments grow “tax-free” until the employee begins to withdraw them upon retirement. If the employee does not use up the funds, they are passed down to that employee’s spouse, children, or other heirs; if the employee uses the funds too quickly and zeros out the account balance, no additional retirement funds are available. This type of plan is called a defined-contribution plan as only the contributions to the retirement account are fixed by contract: the final balance depends on market factors outside of the employee’s control.</p>
<p>When retired, an employee has access to the funds and can withdraw at any rate they wish. Usually, withdrawing 4% of the value per year is the best practice, but funds in the plan will continue to experience market returns.</p>
<p>The funds available in an ORP account depend strongly on the investments chosen. For this project, we will assume that participants invest in a Fidelity Freedom Fund with the following asset allocation:</p>
<ul>
<li>Age 25 to Age 49:
<ul>
<li>54% US Equities</li>
<li>36% International Equities</li>
<li>10% Bonds</li>
</ul></li>
<li>Age 50 to Age 59:
<ul>
<li>47% US Equities</li>
<li>32% International Equities</li>
<li>21% Bonds</li>
</ul></li>
<li>Age 60 to Age 74:
<ul>
<li>34% US Equities</li>
<li>23% International Equities</li>
<li>43% Bonds</li>
</ul></li>
<li>Age 75 or older:
<ul>
<li>19% US Equities</li>
<li>13% International Equities</li>
<li>62% Bonds</li>
<li>6% Short-Term Debt</li>
</ul></li>
</ul>
<p>Both the employee and the employer make monthly contributions to the employee’s ORP account. These returns are calculated as a percentage of the employee’s annual salary, which is the same rate as the TRS:</p>
<ul>
<li>$45,000 or less: 3%</li>
<li>$45,001 to $55,000: 3.5%</li>
<li>$55,001 to $75,000: 4.5%</li>
<li>$75,001 to $100,000: 5.75%</li>
<li>$100,001 or more: 6%</li>
</ul>
<p>The employer contribution is fixed at: - 8% for the first seven years of employment at CUNY - 10% for all years after</p>
</section>
</section>
<section id="data-acquisition" class="level1">
<h1>Data Acquisition</h1>
<p>For this project, we will use data from two economic and financial data services. They are as follows:</p>
<ul>
<li><a href="https://www.alphavantage.co/">AlphaVantage</a>: a commercial stock market data provider</li>
<li><a href="https://fred.stlouisfed.org/">FRED</a>: the Federal Reserve Economic Data repository maintained by the Federal Reserve Bank of St.&nbsp;Louis</li>
</ul>
<p>To begin my Monte Carlo analysis, I will need historical data covering the following. For ease, linked the data I plan to use to each point.</p>
<ul>
<li><a href="https://fred.stlouisfed.org/series/SMU36935610500000003">Wage Growth</a></li>
<li><a href="https://fred.stlouisfed.org/series/CUURA101SA0">Inflation</a></li>
<li><a href="https://www.alphavantage.co/documentation/">US Equity Market Total Returns</a></li>
<li><a href="https://www.alphavantage.co/documentation/">International Equity Market total returns</a></li>
<li><a href="https://fred.stlouisfed.org/series/BAMLHYH0A3CMTRIV">Bond Market Total Returns</a></li>
<li><a href="https://fred.stlouisfed.org/series/DTB3">Short-term debt returns</a></li>
</ul>
First, we must set up the pathways to these sites to get the data.
<details>
<summary>
<strong>Click here to see how to set up the pathway</strong>
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtExtras)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>alpha_vantage_key <span class="ot">&lt;-</span> <span class="st">"657RUGIZTAGDBDOF"</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>fred_key <span class="ot">&lt;-</span> <span class="st">"2220adc19cf9dd1075bb3d55cadc8031"</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>get_alpha_data <span class="ot">&lt;-</span> <span class="cf">function</span>(symbol, <span class="at">interval =</span> <span class="st">"TIME_SERIES_DAILY"</span>, api_key) {</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"https://www.alphavantage.co/query?function="</span>, interval,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>                <span class="st">"&amp;symbol="</span>, symbol, <span class="st">"&amp;apikey="</span>, api_key, <span class="st">"&amp;outputsize=full&amp;datatype=json"</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  response <span class="ot">&lt;-</span> <span class="fu">request</span>(url) <span class="sc">|&gt;</span> <span class="fu">req_perform</span>()</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (response <span class="sc">|&gt;</span> <span class="fu">resp_status</span>() <span class="sc">!=</span> <span class="dv">200</span>) {</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Failed to retrieve Alpha Vantage data. HTTP Status: "</span>, response <span class="sc">|&gt;</span> <span class="fu">resp_status</span>())</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(response <span class="sc">|&gt;</span> <span class="fu">resp_body_string</span>())</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  timeseries <span class="ot">&lt;-</span> data[[<span class="st">"Time Series (Daily)"</span>]]</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(timeseries)) <span class="fu">stop</span>(<span class="st">"Failed to retrieve Alpha Vantage data for symbol: "</span>, symbol)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">do.call</span>(rbind, timeseries))</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">rownames</span>(df)</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(df) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">close =</span> <span class="st">`</span><span class="at">4. close</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">date =</span> <span class="fu">as.Date</span>(date),</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">close =</span> <span class="fu">as.numeric</span>(close)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(date)</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">format</span>(date, <span class="st">"%Y-%m"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(month) <span class="sc">|&gt;</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>      <span class="at">monthly_return =</span> <span class="fu">last</span>(close) <span class="sc">/</span> <span class="fu">first</span>(close) <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">'drop'</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">paste0</span>(month, <span class="st">"-01"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(date, monthly_return)</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>get_fred_data <span class="ot">&lt;-</span> <span class="cf">function</span>(series_id, api_key) {</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>  url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"https://api.stlouisfed.org/fred/series/observations?series_id="</span>, </span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>                series_id, <span class="st">"&amp;api_key="</span>, api_key, <span class="st">"&amp;file_type=json"</span>)</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>  response <span class="ot">&lt;-</span> <span class="fu">request</span>(url) <span class="sc">|&gt;</span> <span class="fu">req_perform</span>()</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (response <span class="sc">|&gt;</span> <span class="fu">resp_status</span>() <span class="sc">!=</span> <span class="dv">200</span>) {</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Failed to retrieve FRED data. HTTP Status: "</span>, response <span class="sc">|&gt;</span> <span class="fu">resp_status</span>())</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(response <span class="sc">|&gt;</span> <span class="fu">resp_body_string</span>())</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(data<span class="sc">$</span>observations)) <span class="fu">stop</span>(<span class="st">"No observations found for series: "</span>, series_id)</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(data<span class="sc">$</span>observations) <span class="sc">|&gt;</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>      <span class="at">date =</span> <span class="fu">as.Date</span>(date),</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>      <span class="at">value =</span> <span class="fu">suppressWarnings</span>(<span class="fu">as.numeric</span>(value))</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">|&gt;</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(date, value)</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<p>Now, we must retrieve the data from these sites.</p>
<details>
<summary>
<strong>Click here to see how the data was downloaded into R</strong>
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Wage Growth </span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>wage_growth <span class="ot">&lt;-</span> <span class="fu">get_fred_data</span>(<span class="st">"SMU36935610500000003"</span>, fred_key) <span class="sc">|&gt;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">format</span>(date, <span class="st">"%Y-%m"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">|&gt;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">wage_growth =</span> <span class="fu">last</span>(value), <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">paste0</span>(month, <span class="st">"-01"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, wage_growth) <span class="sc">|&gt;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">salary =</span> wage_growth <span class="sc">*</span> <span class="dv">40</span> <span class="sc">*</span> <span class="dv">52</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Inflation  </span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>inflation <span class="ot">&lt;-</span> <span class="fu">get_fred_data</span>(<span class="st">"CUURA101SA0"</span>, fred_key) <span class="sc">|&gt;</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">format</span>(date, <span class="st">"%Y-%m"</span>))<span class="sc">|&gt;</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">|&gt;</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">inflation =</span> <span class="fu">last</span>(value), <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">paste0</span>(month, <span class="st">"-01"</span>)))<span class="sc">|&gt;</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, inflation)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co"># U.S. Market Total Returns </span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>us_equity_data <span class="ot">&lt;-</span> <span class="fu">get_alpha_data</span>(<span class="st">"SPY"</span>, <span class="st">"TIME_SERIES_DAILY"</span>, alpha_vantage_key) <span class="sc">|&gt;</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">us_equity_return =</span> monthly_return)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co"># International Stock Market Total Returns</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>international_equity_data <span class="ot">&lt;-</span> <span class="fu">get_alpha_data</span>(<span class="st">"EFA"</span>, <span class="st">"TIME_SERIES_DAILY"</span>, alpha_vantage_key) <span class="sc">|&gt;</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">international_equity_return =</span> monthly_return)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Bond Market Total Returns</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>bond_market_return <span class="ot">&lt;-</span> <span class="fu">get_fred_data</span>(<span class="st">"BAMLHYH0A3CMTRIV"</span>, fred_key) <span class="sc">|&gt;</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">format</span>(date, <span class="st">"%Y-%m"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">|&gt;</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">bond_return =</span> <span class="fu">last</span>(value), <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">paste0</span>(month, <span class="st">"-01"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, bond_return)</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Short-Term Debt Returns</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>short_debt_data <span class="ot">&lt;-</span> <span class="fu">get_fred_data</span>(<span class="st">"DTB3"</span>, fred_key) <span class="sc">|&gt;</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">format</span>(date, <span class="st">"%Y-%m"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">|&gt;</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">short_term_debt_rate =</span> <span class="fu">last</span>(value), <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">paste0</span>(month, <span class="st">"-01"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, short_term_debt_rate)</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge All Data</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>  wage_growth,</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>  inflation,</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>  us_equity_data,</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>  international_equity_data,</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>  bond_market_return,</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>  short_debt_data</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(full_join, <span class="at">by =</span> <span class="st">"date"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-fa563732f8edbbd96037" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-fa563732f8edbbd96037">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214"],["2007-01-01","2007-02-01","2007-03-01","2007-04-01","2007-05-01","2007-06-01","2007-07-01","2007-08-01","2007-09-01","2007-10-01","2007-11-01","2007-12-01","2008-01-01","2008-02-01","2008-03-01","2008-04-01","2008-05-01","2008-06-01","2008-07-01","2008-08-01","2008-09-01","2008-10-01","2008-11-01","2008-12-01","2009-01-01","2009-02-01","2009-03-01","2009-04-01","2009-05-01","2009-06-01","2009-07-01","2009-08-01","2009-09-01","2009-10-01","2009-11-01","2009-12-01","2010-01-01","2010-02-01","2010-03-01","2010-04-01","2010-05-01","2010-06-01","2010-07-01","2010-08-01","2010-09-01","2010-10-01","2010-11-01","2010-12-01","2011-01-01","2011-02-01","2011-03-01","2011-04-01","2011-05-01","2011-06-01","2011-07-01","2011-08-01","2011-09-01","2011-10-01","2011-11-01","2011-12-01","2012-01-01","2012-02-01","2012-03-01","2012-04-01","2012-05-01","2012-06-01","2012-07-01","2012-08-01","2012-09-01","2012-10-01","2012-11-01","2012-12-01","2013-01-01","2013-02-01","2013-03-01","2013-04-01","2013-05-01","2013-06-01","2013-07-01","2013-08-01","2013-09-01","2013-10-01","2013-11-01","2013-12-01","2014-01-01","2014-02-01","2014-03-01","2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01","2015-05-01","2015-06-01","2015-07-01","2015-08-01","2015-09-01","2015-10-01","2015-11-01","2015-12-01","2016-01-01","2016-02-01","2016-03-01","2016-04-01","2016-05-01","2016-06-01","2016-07-01","2016-08-01","2016-09-01","2016-10-01","2016-11-01","2016-12-01","2017-01-01","2017-02-01","2017-03-01","2017-04-01","2017-05-01","2017-06-01","2017-07-01","2017-08-01","2017-09-01","2017-10-01","2017-11-01","2017-12-01","2018-01-01","2018-02-01","2018-03-01","2018-04-01","2018-05-01","2018-06-01","2018-07-01","2018-08-01","2018-09-01","2018-10-01","2018-11-01","2018-12-01","2019-01-01","2019-02-01","2019-03-01","2019-04-01","2019-05-01","2019-06-01","2019-07-01","2019-08-01","2019-09-01","2019-10-01","2019-11-01","2019-12-01","2020-01-01","2020-02-01","2020-03-01","2020-04-01","2020-05-01","2020-06-01","2020-07-01","2020-08-01","2020-09-01","2020-10-01","2020-11-01","2020-12-01","2021-01-01","2021-02-01","2021-03-01","2021-04-01","2021-05-01","2021-06-01","2021-07-01","2021-08-01","2021-09-01","2021-10-01","2021-11-01","2021-12-01","2022-01-01","2022-02-01","2022-03-01","2022-04-01","2022-05-01","2022-06-01","2022-07-01","2022-08-01","2022-09-01","2022-10-01","2022-11-01","2022-12-01","2023-01-01","2023-02-01","2023-03-01","2023-04-01","2023-05-01","2023-06-01","2023-07-01","2023-08-01","2023-09-01","2023-10-01","2023-11-01","2023-12-01","2024-01-01","2024-02-01","2024-03-01","2024-04-01","2024-05-01","2024-06-01","2024-07-01","2024-08-01","2024-09-01","2024-10-01"],[27.93,27.79,27.62,28.09,27.69,27.87,28.48,28.21,28.34,28.09,28.13,29.28,30.19,30.35,30.37,30.09,30.09,30.23,30.33,30.51,30.45,30.17,30.4,30.11,30.15,30.14,30.17,29.83,29.79,29.92,29.88,30.11,30.11,30.05,30.41,30.26,30.46,30.48,30.21,30.41,30.66,30.24,30.33,30.45,30.12,30.37,30.5,30.61,30.95,30.64,30.77,30.73,31.22,30.72,30.72,30.76,31.05,31.41,30.96,31.01,31.68,31.27,31.28,31.74,31.1,31.11,31.57,31.31,31.6,31.4,31.64,32.16,32.14,31.92,31.79,31.92,31.73,32.18,32.08,31.91,32.36,31.92,32,32.47,32.17,32.62,32.59,32.45,32.37,32.93,32.45,32.24,32.54,32.9,33.7,33.04,33.6,33.99,33.95,33.75,33.43,33.36,33.35,33.93,33.62,33.54,34.24,33.5,33.86,34.13,33.68,33.36,33.94,33.21,33.65,34.37,34.07,34.7,34.12,33.97,35.12,35.03,34.92,35.57,34.89,34.73,35.4,34.59,34.87,35.65,35.29,35.57,35.81,35.89,35.79,36.37,35.73,35.73,36.62,35.95,36.56,36.39,36.62,37.28,37.39,37.66,37.21,37.35,37.35,37.98,37.22,37.45,38.2,37.8,38.1,38.81,38.3,38.85,38.43,40.08,38.43,38.11,38.32,39.21,38.68,38.64,39.57,39.5,40.3,40.4,40.09,40.63,41.56,40.8,40.77,41.23,40.41,41.09,40.58,40.97,41.86,41.38,41.39,40.91,41.29,40.71,41.07,41.16,41.43,42.34,41.71,41.79,42.43,42.08,41.72,42.71,41.66,41.49,42.53,41.5,41.66,41.89,41.56,41.86,42.5,42.33,42.11,41.99,42.02,43.09,42.11,42.02,43.05,42.52],[58094.4,57803.2,57449.6,58427.2,57595.2,57969.6,59238.4,58676.8,58947.2,58427.2,58510.4,60902.4,62795.2,63128,63169.6,62587.2,62587.2,62878.4,63086.39999999999,63460.8,63336,62753.60000000001,63232,62628.8,62712,62691.2,62753.60000000001,62046.39999999999,61963.2,62233.60000000001,62150.4,62628.8,62628.8,62504,63252.8,62940.8,63356.8,63398.4,62836.8,63252.8,63772.8,62899.2,63086.39999999999,63336,62649.6,63169.6,63440,63668.8,64376,63731.2,64001.6,63918.4,64937.6,63897.6,63897.6,63980.8,64584,65332.8,64396.8,64500.8,65894.40000000001,65041.6,65062.4,66019.2,64688,64708.8,65665.59999999999,65124.8,65728,65312,65811.2,66892.79999999999,66851.2,66393.60000000001,66123.2,66393.60000000001,65998.40000000001,66934.40000000001,66726.39999999999,66372.8,67308.8,66393.60000000001,66560,67537.59999999999,66913.60000000001,67849.59999999999,67787.20000000001,67496,67329.59999999999,68494.40000000001,67496,67059.20000000001,67683.2,68432,70096,68723.2,69888,70699.20000000001,70616,70200,69534.40000000001,69388.8,69368,70574.40000000001,69929.59999999999,69763.2,71219.20000000001,69680,70428.8,70990.40000000001,70054.40000000001,69388.8,70595.2,69076.8,69992,71489.59999999999,70865.59999999999,72176,70969.59999999999,70657.59999999999,73049.59999999999,72862.40000000001,72633.60000000001,73985.59999999999,72571.2,72238.39999999999,73632,71947.20000000001,72529.59999999999,74152,73403.2,73985.59999999999,74484.8,74651.2,74443.2,75649.59999999999,74318.39999999999,74318.39999999999,76169.59999999999,74776,76044.8,75691.2,76169.59999999999,77542.40000000001,77771.2,78332.79999999999,77396.8,77688,77688,78998.39999999999,77417.59999999999,77896,79456,78624,79248,80724.8,79664,80808,79934.40000000001,83366.39999999999,79934.40000000001,79268.8,79705.59999999999,81556.8,80454.40000000001,80371.2,82305.59999999999,82160,83824,84032,83387.20000000001,84510.40000000001,86444.8,84864,84801.60000000001,85758.39999999999,84052.79999999999,85467.20000000001,84406.39999999999,85217.59999999999,87068.8,86070.40000000001,86091.2,85092.79999999999,85883.2,84676.8,85425.59999999999,85612.79999999999,86174.40000000001,88067.20000000001,86756.8,86923.2,88254.40000000001,87526.39999999999,86777.59999999999,88836.8,86652.79999999999,86299.20000000001,88462.40000000001,86320,86652.79999999999,87131.2,86444.8,87068.8,88400,88046.39999999999,87588.8,87339.20000000001,87401.60000000001,89627.20000000001,87588.8,87401.60000000001,89544,88441.60000000001],[221.767,223.066,224.551,225.78,227.146,228.258,228.628,228.326,228.308,228.552,229.504,229.395,229.869,231.02,233.122,233.822,236.151,238.58,240.273,240.55,240.089,238.403,234.498,233.012,233.402,234.663,235.067,235.582,235.975,237.172,237.6,238.282,238.568,238.38,238.777,238.427,238.97,238.862,240.101,240.529,241.075,240.817,241.147,241.569,241.485,241.981,241.96,241.874,242.639,243.832,245.617,246.489,248.073,248.505,249.164,250.058,250.559,250.051,249.317,248.307,249.322,250.285,251.887,252.349,252.652,252.406,252.016,253.472,254.554,254.277,254.285,253.555,254.807,256.234,256.589,255.967,256.27,256.911,257.326,257.659,258.504,257.069,257.377,257.284,259.596,259.019,259.971,259.985,261.225,261.35,261.498,261.075,261.074,260.5,259.382,258.08,258.376,259.24,259.647,259.959,261.066,261.512,261.199,261.347,261.887,261.515,261.009,259.941,260.342,260.875,261.508,262.619,263.312,263.877,263.722,264.16,264.602,264.738,265.203,265.421,266.917,267.662,267.582,267.948,268.183,268.666,268.051,268.657,270.059,269.575,269.381,269.564,270.771,272.214,272.196,272.95,274.001,274.17,274.073,274.441,275.455,275.101,274.478,273.836,275.144,275.823,276.57,277.441,278.068,278.802,278.817,279.428,279.338,279.255,279.468,279.816,282.02,282.577,281.975,280.623,282.092,282.333,283.624,283.478,284.551,284.121,283.291,284.35,285.525,286.474,287.481,289.493,290.991,293.872,293.553,293.927,295.488,296.472,297.49,296.865,300.164,301.151,305.024,307.781,309.243,313.589,312.615,313.28,313.88,314.338,314.975,315.656,318.151,319.295,319.038,319.211,320.002,321.29,322.496,324.38,325.613,325.288,324.52,324.691,328.006,328.606,329.829,331.27,332.633,334.782,335.642,336.534,337.889,338.166],[0.01683525500459782,-0.02544775603346938,0.01060422745712053,0.04312042768711311,0.03127732562050189,-0.02368899273104885,-0.03998945912115415,0.007921873932937196,0.02347732760933718,0.002268308489954629,-0.01569224657352852,-0.009953954496208062,-0.05216311322707512,-0.04126665711419986,-0.01146067415730334,0.01207817875704542,-0.005456349206349298,-0.07861771058315337,-0.01207353170275738,0.02084654407102082,-0.0937573247909993,-0.1656901602619335,-0.07228915662650603,0.09901351845085848,-0.1089716006884681,-0.1047469120852506,0.1263456090651558,0.07846039970392304,0.05279326430765741,-0.02975625197847409,0.07018303909888446,0.02011150935882111,0.05379241516966071,0.005729824220646718,0.05387269938650308,0.001257861635220126,-0.05241330627371388,0.01540436456996153,0.0456698543212084,0.008573853989813252,-0.09123390112172824,-0.04008183762670881,0.0730829116387699,-0.06606952820148992,0.05227733726719519,0.03385393944681958,-0.0003374673078545554,0.03917031650276837,0.01282959464777655,0.01843353220131561,0.01267853051248746,0.02463387157341335,-0.009690207018059005,0.0007583225904299606,-0.0342741935483869,-0.05093958689237466,-0.06441210517612028,0.1416355862821794,0.02450819672131144,0.004241017844282657,0.02996078431372551,0.03434739941118758,0.02236259347999714,-0.01388888888888884,-0.06586613613755865,0.06195380774032455,0.008790564793788036,0.02594665309978916,0.02084662837694107,-0.02078281953585037,-0.004760904571868729,0.006786850477200401,0.02492126523346561,0.002446442740015931,0.02997830517388711,0.02326177507209226,0.03266363406621164,-0.02391238211134783,0.04555032226078337,-0.04107582327434656,0.0220208041851695,0.03808905161214127,0.02718347426366252,0.02304326150778269,-0.02591296741745019,0.06958718493425975,0.01097415936858037,0.0003187250996015134,0.02309775394254765,0.01461897356143083,-0.01999695477846009,0.0426493506493506,-0.01789541897213498,0.03761255466941082,0.02691183030182875,-0.001069206842923776,-0.02910967239448969,0.04328446909667205,-0.02622765224774759,0.01341759844433654,0.001993166287015846,-0.02684690646121857,0.01387483740424922,-0.05812234778047964,-0.0009386243938050987,0.08223598605111127,-0.0080802319501877,-0.03232390355040826,-0.03631479454780628,-0.0004647560030983655,0.03740346272272976,-0.002851343514401528,0.008991681492523051,-0.003757074237884739,0.03429878048780499,0.002028210565133248,-0.005014030084180443,-0.01496894985633512,0.04440547841334541,0.01803525071731116,0.01016693304919203,0.03888059045778047,-0.01684877804654261,0.01168571792801587,0.01156359979889388,-0.006410256410256387,0.01882663804136908,0.0006873685912986982,0.01367817947062622,0.01914235890932137,0.02920501767058914,0.009075096422899609,0.04885217844253442,-0.03526528872789259,-0.01699663802764295,0.02734299141647556,0.02249226356706169,-0.008479532163742864,0.03483410578974455,0.03364665669728684,0.003139988268175742,-0.07232715181846239,0.007824211180578411,-0.1051915503043324,0.07894316092413467,0.03191883285195884,0.007346123671635452,0.0286533953748731,-0.05668071690483545,0.06712313799759628,0.005986606236893621,-0.008106091439424756,0.02074018022975843,0.03440867548765514,0.0266871366041681,0.03279424977538192,-0.00966540462338783,-0.08595581883253123,-0.1661004885308486,0.1800934389599838,0.07613423388380069,0.009196530846015349,0.0515264717248487,0.06241065725843242,-0.05022688598979019,-0.03115357227628768,0.09648697758933977,0.02147423638052559,0.003470809946039655,0.01097732769848236,0.01732635145541361,0.0416614662639474,0.004399808703969388,0.01999189839635895,0.01877192574866982,0.03192486117141624,-0.05015493581230634,0.05759487840825339,-0.009738283627510724,0.05429522752497218,-0.05819430198237419,-0.03603046693895573,0.05037443602028002,-0.09034708116223622,-0.003739625554912251,-0.07895700578627407,0.08065785332074293,-0.03795311244735489,-0.09898592401997885,0.05346280788849178,0.06023093727244366,-0.06124502921105601,0.06738091486791675,-0.03539435248296008,0.03711303642904173,0.01211826256235549,0.005631633414358239,0.05087478071215212,0.03154645215079199,-0.01342884682790046,-0.05254992353553933,-0.02131941681683092,0.07982775753560767,0.03530821171857967,0.02164392256426528,0.03859362224039242,0.01992785414838649,-0.03864715795924611,0.05400219846107723,0.03111026904130365,0.01003043972567563,0.03806559731864967,0.03926967106216472,3.517287467902364e-05],[0.009930621684124397,-0.009083622762489862,0.03910614525139677,0.03477124183006541,0.02465857359635826,-0.009686120647376284,-0.03685623627044177,-0.00796963946869067,0.04359363153904483,0.0292887029288702,-0.0155415826313916,-0.05044151445506229,-0.07517259013040134,-0.02651121685927937,0.001253307338810794,0.02210998771742245,0.005768978628556409,-0.09537610328020019,-0.02267039599587817,-0.02798165137614683,-0.1004952867870268,-0.2023979957050823,-0.06748603351955318,0.1706680584551148,-0.1483274647887323,-0.09498956158663885,0.1498929336188439,0.08685506870624837,0.1188398962508843,-0.05779514603044,0.08245651707107582,0.02132609538580854,0.06443449484134711,0.0009389671361501595,0.02917131178000743,-0.02864171498857837,-0.07491627005111934,-0.01534431137724557,0.05562888930793886,-0.04493593119185535,-0.1182481751824817,-0.02780100334448177,0.1000211909302817,-0.06932538203503535,0.06187161639597849,0.02779981250450692,-0.04471830985915493,0.04336917562724008,0.01260647359454836,0.01150369761709125,-0.01005107925523152,0.04633140972794725,-0.02833881321434151,-0.007426968146558854,-0.03437499999999993,-0.07590132827324481,-0.09695709695709687,0.1259673258813414,0.009854158454867923,-0.02499999999999991,0.02466345681438553,0.0320996978851964,-0.007054992764110035,-0.03205474518278406,-0.1150639244024458,0.07325456498388827,-0.005766553986876088,0.03179364127174567,0.03233346318659902,0.00271383118098445,0.01586423169156981,0.03119332607907133,0.02138713308511564,-0.02077375946173254,0.01514629948364887,0.06481003953928144,-0.02436251421146662,-0.04975124378109452,0.04339557399723382,-0.03269576589831613,0.05788426463273089,0.02712815715622074,0.01037217815741287,0.02045627376425863,-0.03489607039902898,0.08345369924570689,0.01694915254237306,0.01020257282271175,0.01313676835498456,-0.01696621135873466,-0.03450775699579522,0.008770603357024065,-0.04069419509275884,0.009311868686868729,0.009305993690851722,-0.04833411543876109,0.01056454275338403,0.05067785668173008,-0.0157975460122699,0.02908865851771636,-0.009070631970260257,-0.04468853445681598,0.01377151799687004,-0.07181550843522677,-0.01104209799861977,0.06278260869565222,-0.01685848597827844,-0.04193179964105076,-0.04047042545831903,-0.03229880909418981,0.03870616027621288,0.03324491600353685,-0.01017293997965407,-0.0430310303445911,0.03968111787889628,0.01196670135275757,0.00646808510638297,-0.01950144141088683,-0.01354872329338197,0.02050556832243222,0.0265105870201412,0.007850342408551869,0.02164999179924543,0.02572347266881025,0.03122073056509511,-0.0194014137464279,0.02779484029484025,-0.005943536404160343,0.02224212569040174,0.01768488745980701,0.00588235294117645,0.006873836459974303,0.04249611746435145,-0.05104659014179613,0.008539586047184855,0.0293946449359721,-0.0154631862675555,-0.04328571428571426,0.03797468354430378,-0.01736465781409602,0.01827167889770864,-0.08241516086381651,-0.007745810938981856,-0.07578616352201262,0.06853051483123096,0.02569422278965838,0.003714020427112219,0.01628862840615031,-0.04489304007231087,0.03073545554335899,-0.0240763173834041,-0.01649292049167572,0.03360278966555708,0.04413814464921795,0.002352249338430035,0.023735810113519,-0.03792415169660679,-0.07983441750443521,-0.1519670050761421,0.1072616950479546,0.07770148174918678,-0.001640150893882253,0.01554828150572818,0.0271893771735694,-0.02152190622598005,-0.04108091221493282,0.1279948544782121,0.01615598885793856,-0.01295336787564771,0.01037542662116042,0.006233421750663215,0.01626333593546714,0.02355324806888692,-0.02761341222879699,0.005311749083090955,0.009387908374014264,-0.04129285977633035,0.02928388746803057,-0.05450965916082184,0.02984293193717269,-0.0425558782674581,-0.04337601254246159,0.02764590896397645,-0.07605330461704141,0.02249160216153068,-0.09787786920744901,0.049169859514687,-0.06245251481537761,-0.0798422868408083,0.03834033613445387,0.1227835396453665,-0.0314298362107126,0.08048927816369678,-0.03934062889596901,0.02581755593803781,0.02122347066167296,-0.03863419942864921,0.01087562744004456,0.028169014084507,-0.02719978240174081,-0.03594908378794226,-0.01457811809748188,0.07209474463360488,0.02965291063131992,0.006710508656556202,0.01980198019801982,0.02384615384615385,-0.02829476861167002,0.05291828793774345,-0.03783319002579533,0.02408563782337203,0.06071839447782179,0.02399902044814484,-0.04565714974099511],[189.76,193.03,193.34,197.13,199.89,196.32,186.14,187,192.23,193.24,186.11,185.7,177.55,174.63,174.06,184.29,186.75,179.98,175.17,174.13,156.54,120.87,102.73,114.57,114.1,105.27,114.52,137.01,154.41,161.78,179.31,185.45,204.26,209.7,213.38,225.46,230.87,230.42,240.17,249.34,235.11,236.72,245.53,241.63,250.81,259.69,257.61,267,275.2,280.17,281.12,286.95,286.75,281.77,283.22,261.62,243.61,267.31,255.21,263.27,275.86,285.48,287.37,290.01,282.85,290.08,294.45,299.22,305.72,306.32,308.43,316.62,326.17,327.95,333.69,340.83,341.8,332.86,340.74,339.53,343.17,350.87,354.2,357.66,360.84,367.13,368.59,371.2,375.12,379.4,373.64,376.91,365.85,363.41,360.1,348.47,346.61,357.49,354.66,360.89,360.66,353.11,344.65,334.4,323.59,327,311.68,296.14,284.61,278.97,307.47,332.55,343.13,351.17,361.83,374.82,381.46,387.47,389.51,404.1,414.27,427.5,425,427.51,432.9,432.21,440.12,436.64,443.65,444.1,442.99,446.9,455.6,452.91,448.52,454.91,458.82,464.58,471.18,472.63,477.82,464.39,448.2,428.36,453.33,462.35,462.2,472.71,458.85,465.2,464.87,454.36,454.63,452.41,442.39,467.37,465.3,454.27,362.53,364.5,385.83,397.94,414.83,426.66,428.48,429.66,461.77,480.72,492.08,499.94,505.76,512.51,516.59,526.46,524.77,528.13,531.78,529.8099999999999,522.16,530.84,520.8099999999999,516.11,511.07,490.32,474.81,439.98,461.48,462.9,439.25,446.84,447.24,444.18,471.81,472.95,465.7,474.93,471.62,487.71,499.59,504.69,501.52,484.14,505.16,534.62,532.54,544.9400000000001,551.8200000000001,543.01,549.66,552.8200000000001,574.92,586.1900000000001,616.6799999999999,620.5],[4.99,5.01,4.9,4.79,4.6,4.68,4.82,3.91,3.72,3.84,3.08,3.29,1.92,1.81,1.36,1.41,1.85,1.87,1.65,1.69,0.9,0.44,0.01,0.11,0.24,0.26,0.21,0.14,0.14,0.19,0.18,0.15,0.14,0.05,0.06,0.06,0.08,0.13,0.16,0.16,0.16,0.18,0.15,0.14,0.16,0.12,0.17,0.12,0.15,0.15,0.09,0.04,0.06,0.03,0.1,0.02,0.02,0.01,0.01,0.02,0.06,0.08,0.07000000000000001,0.1,0.07000000000000001,0.09,0.11,0.09,0.1,0.11,0.08,0.05,0.07000000000000001,0.11,0.07000000000000001,0.05,0.04,0.04,0.04,0.03,0.02,0.04,0.06,0.07000000000000001,0.02,0.05,0.05,0.03,0.04,0.04,0.03,0.03,0.02,0.01,0.02,0.04,0.02,0.02,0.03,0.01,0.01,0.01,0.08,0.08,-0.01,0.08,0.22,0.16,0.32,0.33,0.21,0.22,0.34,0.26,0.27,0.33,0.28,0.34,0.48,0.5,0.52,0.53,0.75,0.79,0.96,1.01,1.05,0.99,1.04,1.13,1.25,1.37,1.44,1.63,1.7,1.84,1.89,1.89,1.99,2.07,2.15,2.29,2.32,2.4,2.36,2.4,2.35,2.38,2.3,2.08,2.04,1.95,1.84,1.51,1.56,1.52,1.52,1.25,0.11,0.09,0.14,0.16,0.09,0.11,0.1,0.09,0.08,0.09,0.06,0.04,0.03,0.01,0.01,0.05,0.06,0.04,0.04,0.05,0.05,0.06,0.24,0.37,0.51,0.83,1.13,1.66,2.34,2.87,3.22,4.06,4.27,4.3,4.58,4.72,4.68,4.95,5.26,5.17,5.28,5.32,5.32,5.33,5.25,5.2,5.22,5.25,5.23,5.25,5.25,5.22,5.15,4.98,4.52,4.44]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>date<\/th>\n      <th>wage_growth<\/th>\n      <th>salary<\/th>\n      <th>inflation<\/th>\n      <th>us_equity_return<\/th>\n      <th>international_equity_return<\/th>\n      <th>bond_return<\/th>\n      <th>short_term_debt_rate<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6,7,8]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"date","targets":1},{"name":"wage_growth","targets":2},{"name":"salary","targets":3},{"name":"inflation","targets":4},{"name":"us_equity_return","targets":5},{"name":"international_equity_return","targets":6},{"name":"bond_return","targets":7},{"name":"short_term_debt_rate","targets":8}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="initial-analysis" class="level1">
<h1>Initial Analysis</h1>
<p>First, I want to see the difference between certain aspects of our data. Firstly, I want to see the difference between the growth in hourly wage rate and inflation. This can help me anticipate how much the value of money will continue to be in the future compared to the price of goods.</p>
<details>
<summary>
<strong>Click here to see how to make the line graph</strong>
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>wage_vs_inflation <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  wage_growth,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  inflation</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(full_join, <span class="at">by =</span> <span class="st">"date"</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">|&gt;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>salary)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>Overtime <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(wage_vs_inflation, <span class="fu">aes</span> (<span class="at">x =</span> date)) <span class="sc">+</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> wage_growth, <span class="at">color =</span> <span class="st">"Wage Growth Rate"</span>)) <span class="sc">+</span> </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> inflation, <span class="at">color =</span> <span class="st">"Inflation Growth Rate"</span>)) <span class="sc">+</span> </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Wage Growth Rate"</span> <span class="ot">=</span> <span class="st">"chartreuse4"</span>, <span class="st">"Inflation Growth Rate"</span> <span class="ot">=</span> <span class="st">"firebrick2"</span>)) <span class="sc">+</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"The Growth Rate Between Wage Rate and Inflation Rate Overtime, 2007-2024"</span>, <span class="at">x =</span> <span class="st">"Date"</span>, <span class="at">y =</span> <span class="st">"Rate"</span>) <span class="sc">+</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(Overtime)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Below shows the difference between the United States Stock Market Total Returns and the International Stock Market Total Returns. This can show me how well the United States’ stock market is doing compared to the rest of the world.</p>
<details>
<summary>
<strong>Click here to see how to make the line graph</strong>
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>US_vs_international <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  us_equity_data,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  international_equity_data</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(full_join, <span class="at">by =</span> <span class="st">"date"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>Overtime2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(US_vs_international, <span class="fu">aes</span> (<span class="at">x =</span> date)) <span class="sc">+</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> us_equity_return, <span class="at">color =</span> <span class="st">"US Stock Market Total Returns"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> international_equity_return, <span class="at">color =</span> <span class="st">"International Stock Market Total Returns"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"US Stock Market Total Returns"</span> <span class="ot">=</span> <span class="st">"darkseagreen"</span>, <span class="st">"International Stock Market Total Returns"</span> <span class="ot">=</span> <span class="st">"darkorchid"</span>)) <span class="sc">+</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"US Stock Market Total Returns vs International Stock Market Total Returns, 2007-2024"</span>, <span class="at">x =</span> <span class="st">"Date"</span>, <span class="at">y =</span> <span class="st">"Monthly Return"</span>) <span class="sc">+</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(Overtime2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The following graph shows the relationship between the Bond Market Total Returns and Short-Term Debt Returns.</p>
<details>
<summary>
<strong>Click here to see how to make the line graph</strong>
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>Bondreturn_vs_shortdebt <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  bond_market_return,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  short_debt_data</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(full_join, <span class="at">by =</span> <span class="st">"date"</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>Overtime3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(Bondreturn_vs_shortdebt, <span class="fu">aes</span> (<span class="at">x =</span> date)) <span class="sc">+</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> bond_return, <span class="at">color =</span> <span class="st">"Bond Market Total Return"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> short_term_debt_rate, <span class="at">color =</span> <span class="st">"Short-Term Debt Returns"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Bond Market Total Return"</span> <span class="ot">=</span> <span class="st">"darkseagreen"</span>, <span class="st">"Short-Term Debt Returns"</span> <span class="ot">=</span> <span class="st">"darkorchid"</span>)) <span class="sc">+</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Bond Market Total Return vs Short-Term Debt Returns, 2007-2024"</span>, <span class="at">x =</span> <span class="st">"Date"</span>, <span class="at">y =</span> <span class="st">"Monthly Returns"</span>) <span class="sc">+</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(Overtime3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now, I want to know the average monthly average of each of these data points. The following can be seen below.</p>
<details>
<summary>
<strong>Click here to see how the averages were calculated</strong>
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>averages <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Average =</span> <span class="fu">c</span>(<span class="st">"Wage_Average"</span>, <span class="st">"Inflation_Average"</span>, <span class="st">"US_Stock_Market_Return_Average"</span>, <span class="st">"International_Stock Market_Return_Average"</span>, <span class="st">"Bond_Market_Return_Average"</span>, <span class="st">"Short_Term_Debt_Return_Average"</span>),</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Value =</span> <span class="fu">c</span>(wage_average <span class="ot">&lt;-</span> <span class="fu">mean</span>(wage_growth<span class="sc">$</span>wage_growth), </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>            inflation_average <span class="ot">&lt;-</span> <span class="fu">mean</span>(inflation<span class="sc">$</span>inflation), </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>            US_Market_average <span class="ot">&lt;-</span> <span class="fu">mean</span>(us_equity_data<span class="sc">$</span>us_equity_return), </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>            international_average <span class="ot">&lt;-</span> <span class="fu">mean</span>(international_equity_data<span class="sc">$</span>international_equity_return), </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>            bond_average <span class="ot">&lt;-</span> <span class="fu">mean</span>(bond_market_return<span class="sc">$</span>bond_return), </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>            short_term_debt_average <span class="ot">&lt;-</span> <span class="fu">mean</span>(short_debt_data<span class="sc">$</span>short_term_debt_rate))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(averages)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-ab02a714900aa3c818b2" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ab02a714900aa3c818b2">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6"],["Wage_Average","Inflation_Average","US_Stock_Market_Return_Average","International_Stock Market_Return_Average","Bond_Market_Return_Average","Short_Term_Debt_Return_Average"],[34.81644859813084,114.6510501858736,0.00411439049469483,null,276.5834421364985,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Average<\/th>\n      <th>Value<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Average","targets":1},{"name":"Value","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="historical-comparison" class="level1">
<h1>Historical Comparison</h1>
<p>To conduct this comparison, we must make some assumptions. Firstly, we will assume that we joined CUNY in the first month of the historical data, January 1, 2007, and retired in the final month of the data, October 1, 2024. Since the average salary in New York in 2007 was $58,094.40, we will assume a starting salary of $60,000.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>January_salary <span class="ot">&lt;-</span> wage_growth[<span class="fu">format</span>(wage_growth<span class="sc">$</span>date, <span class="st">"%m"</span>) <span class="sc">==</span> <span class="st">"01"</span>, ] <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">difference =</span> salary <span class="sc">-</span> <span class="fu">lag</span>(salary))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(January_salary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-5f3dfe9ba0e3688c0ad9" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5f3dfe9ba0e3688c0ad9">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18"],["2007-01-01","2008-01-01","2009-01-01","2010-01-01","2011-01-01","2012-01-01","2013-01-01","2014-01-01","2015-01-01","2016-01-01","2017-01-01","2018-01-01","2019-01-01","2020-01-01","2021-01-01","2022-01-01","2023-01-01","2024-01-01"],[27.93,30.19,30.15,30.46,30.95,31.68,32.14,32.17,33.6,33.86,35.12,35.81,37.39,38.3,40.3,41.86,42.43,42.5],[58094.4,62795.2,62712,63356.8,64376,65894.40000000001,66851.2,66913.60000000001,69888,70428.8,73049.59999999999,74484.8,77771.2,79664,83824,87068.8,88254.40000000001,88400],[null,4700.800000000003,-83.20000000000437,644.8000000000029,1019.199999999997,1518.400000000009,956.7999999999884,62.40000000000873,2974.399999999994,540.8000000000029,2620.799999999988,1435.200000000012,3286.399999999994,1892.800000000003,4160,3244.800000000003,1185.600000000006,145.5999999999913]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>date<\/th>\n      <th>wage_growth<\/th>\n      <th>salary<\/th>\n      <th>difference<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"date","targets":1},{"name":"wage_growth","targets":2},{"name":"salary","targets":3},{"name":"difference","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Here we can see the salary increase each January 1st from 2007 to 2024. To stay about average with the wage increase, I will assume that I get a raise every 5 years. The first raise will be $5,000, the second will be $7,000, and the final one will be $12,000. This will create the following salaries, per year:</p>
<ul>
<li>2007 - 2011: $60,000</li>
<li>2012 - 2016: $65,000</li>
<li>2017 - 2021: $72,000</li>
<li>2022 - 2024: $84,000</li>
</ul>
<p>Though these raises seem random, they are selected to put us near the New York salary average by 5-year increments.</p>
<p>Now, let’s see how much money we put into the pension plan over our time as an employee.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>years1_to_5 <span class="ot">&lt;-</span> (.<span class="dv">045</span> <span class="sc">*</span> <span class="dv">60000</span>) <span class="sc">*</span> <span class="dv">5</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>years6_to_10 <span class="ot">&lt;-</span> (.<span class="dv">045</span> <span class="sc">*</span> <span class="dv">65000</span>) <span class="sc">*</span> <span class="dv">5</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>years11_15 <span class="ot">&lt;-</span> (.<span class="dv">045</span> <span class="sc">*</span> <span class="dv">72000</span>) <span class="sc">*</span> <span class="dv">5</span> </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>years15_to_17 <span class="ot">&lt;-</span> (.<span class="dv">0575</span> <span class="sc">*</span> <span class="dv">84000</span>) <span class="sc">*</span> <span class="dv">3</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>total_paid <span class="ot">&lt;-</span> (years1_to_5 <span class="sc">+</span> years6_to_10 <span class="sc">+</span> years11_15 <span class="sc">+</span> years15_to_17)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(total_paid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 58815</code></pre>
</div>
</div>
<p>Thus, over our career, we would have paid $58,815 worth of pension to the state. Now, let’s see which option of retirement would be better for us to take.</p>
<section id="trs" class="level3">
<h3 class="anchored" data-anchor-id="trs">TRS:</h3>
<p>Since 2007 to 2024 is only 17 years, we fall under the first bracket with the following equation: 1.75% * FAS * N, if N is equal to 20 years.</p>
<p>Since we made $84,000 for our final three years, 2022, 2023, and 2024, our final average salary would be $84,000.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>month_one_TRS <span class="ot">&lt;-</span> (.<span class="dv">0167</span> <span class="sc">*</span> <span class="dv">84000</span> <span class="sc">*</span> <span class="dv">17</span>) <span class="sc">/</span> <span class="dv">12</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(month_one_TRS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1987.3</code></pre>
</div>
</div>
<p>Thus, our first month of retirement with this plan will leave us with $1,987.30.</p>
</section>
<section id="orp" class="level3">
<h3 class="anchored" data-anchor-id="orp">ORP</h3>
<p>For this plan, it is recommended that you only take 4% out a year. Thus, once we get our total, we will divide it by four.</p>
<details>
<summary>
<strong>Click here to see how the math was calculated</strong>
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>overall_ORP <span class="ot">&lt;-</span> ((<span class="dv">60000</span> <span class="sc">*</span> .<span class="dv">045</span> <span class="sc">+</span> <span class="dv">60000</span> <span class="sc">*</span> .<span class="dv">08</span>) <span class="sc">*</span> <span class="dv">5</span>) <span class="sc">+</span> ((<span class="dv">65000</span> <span class="sc">*</span> .<span class="dv">045</span> <span class="sc">+</span> <span class="dv">65000</span> <span class="sc">*</span> .<span class="dv">08</span>) <span class="sc">*</span> <span class="dv">2</span>) <span class="sc">+</span> ((<span class="dv">65000</span> <span class="sc">*</span> .<span class="dv">045</span> <span class="sc">+</span> <span class="dv">60000</span> <span class="sc">*</span> .<span class="dv">1</span>) <span class="sc">*</span> <span class="dv">3</span>) <span class="sc">+</span>  (((<span class="dv">72000</span> <span class="sc">*</span> .<span class="dv">045</span> <span class="sc">+</span> <span class="dv">72000</span> <span class="sc">*</span> .<span class="dv">10</span>) <span class="sc">*</span> <span class="dv">5</span>) <span class="sc">+</span> ((<span class="dv">84000</span> <span class="sc">*</span> .<span class="dv">045</span> <span class="sc">+</span> <span class="dv">84000</span> <span class="sc">*</span> .<span class="dv">1</span>) <span class="sc">*</span> <span class="dv">2</span>))</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>Age43_to_49 <span class="ot">&lt;-</span> ((<span class="dv">60000</span> <span class="sc">*</span> .<span class="dv">045</span> <span class="sc">+</span> <span class="dv">60000</span> <span class="sc">*</span> .<span class="dv">08</span>) <span class="sc">*</span> <span class="dv">5</span>) <span class="sc">+</span> ((<span class="dv">65000</span> <span class="sc">*</span> .<span class="dv">045</span> <span class="sc">+</span> <span class="dv">65000</span> <span class="sc">*</span> .<span class="dv">08</span>) <span class="sc">*</span> <span class="dv">1</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>US_Equities_1 <span class="ot">&lt;-</span> Age43_to_49 <span class="sc">*</span> .<span class="dv">54</span> <span class="sc">*</span> <span class="fl">1.004</span> </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>Int_Equities_1 <span class="ot">&lt;-</span> Age43_to_49 <span class="sc">*</span> .<span class="dv">36</span> <span class="sc">*</span> .<span class="dv">996</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>bond_1 <span class="ot">&lt;-</span> Age43_to_49 <span class="sc">*</span> .<span class="dv">1</span> <span class="sc">*</span> <span class="fl">1.77</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>total_1 <span class="ot">&lt;-</span> US_Equities_1 <span class="sc">+</span> Int_Equities_1 <span class="sc">+</span> bond_1 </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>Age_50_to_60 <span class="ot">&lt;-</span> ((<span class="dv">65000</span> <span class="sc">*</span> .<span class="dv">045</span> <span class="sc">+</span> <span class="dv">65000</span> <span class="sc">*</span> .<span class="dv">08</span>) <span class="sc">*</span> <span class="dv">1</span>) <span class="sc">+</span> ((<span class="dv">65000</span> <span class="sc">*</span> .<span class="dv">045</span> <span class="sc">+</span> <span class="dv">60000</span> <span class="sc">*</span> .<span class="dv">1</span>) <span class="sc">*</span> <span class="dv">3</span>) <span class="sc">+</span>  (((<span class="dv">72000</span> <span class="sc">*</span> .<span class="dv">045</span> <span class="sc">+</span> <span class="dv">72000</span> <span class="sc">*</span> .<span class="dv">10</span>) <span class="sc">*</span> <span class="dv">5</span>) <span class="sc">+</span> ((<span class="dv">84000</span> <span class="sc">*</span> .<span class="dv">045</span> <span class="sc">+</span> <span class="dv">84000</span> <span class="sc">*</span> .<span class="dv">1</span>) <span class="sc">*</span> <span class="dv">2</span>))</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>US_Equities_2 <span class="ot">&lt;-</span> Age_50_to_60  <span class="sc">*</span> .<span class="dv">47</span> <span class="sc">*</span> <span class="fl">1.004</span> </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>Int_Equities_2 <span class="ot">&lt;-</span> Age_50_to_60  <span class="sc">*</span> .<span class="dv">32</span> <span class="sc">*</span> .<span class="dv">996</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>bond_2 <span class="ot">&lt;-</span> Age_50_to_60  <span class="sc">*</span> .<span class="dv">21</span> <span class="sc">*</span> <span class="fl">1.77</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>total_2 <span class="ot">&lt;-</span> US_Equities_2 <span class="sc">+</span> Int_Equities_2 <span class="sc">+</span> bond_2 </span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>total_ORP <span class="ot">&lt;-</span> total_1 <span class="sc">+</span> total_2 </span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>month_one_orp <span class="ot">&lt;-</span> (total_ORP <span class="sc">*</span> .<span class="dv">04</span>)<span class="sc">/</span><span class="dv">12</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(month_one_orp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 595.7364</code></pre>
</div>
</div>
<p>To find the total amount, I used the average of each return to calculate the total built up overtime. Thus, the first monthly takeaway will be $595.74.</p>
</section>
</section>
<section id="long-term-average-analysis" class="level1">
<h1>Long-Term Average Analysis</h1>
<p>We will assume that we began working at 43, retired at 60, and pass away at 90 years old. That is 30 years of retirement.</p>
<section id="trs-1" class="level3">
<h3 class="anchored" data-anchor-id="trs-1">TRS:</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>total_pay_out <span class="ot">&lt;-</span> (.<span class="dv">0167</span> <span class="sc">*</span> <span class="dv">84000</span> <span class="sc">*</span> <span class="dv">17</span>) <span class="sc">*</span> <span class="dv">30</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(total_pay_out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 715428</code></pre>
</div>
</div>
<p>Thus, the total life-time pay out will be $715,428.</p>
</section>
<section id="orp-1" class="level3">
<h3 class="anchored" data-anchor-id="orp-1">ORP:</h3>
<details>
<summary>
<strong>Click here to see how the math was calculated</strong>
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>V1 <span class="ot">&lt;-</span> ((<span class="fl">178720.9</span> <span class="sc">-</span> (<span class="fl">178720.9</span> <span class="sc">*</span> .<span class="dv">04</span>)) <span class="sc">*</span> <span class="fl">1.07</span>) </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>V2 <span class="ot">&lt;-</span> ((V1 <span class="sc">-</span> (V1 <span class="sc">*</span> .<span class="dv">04</span>)) <span class="sc">*</span> <span class="fl">1.07</span>) </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>V3 <span class="ot">&lt;-</span> ((V2 <span class="sc">-</span> (V2 <span class="sc">*</span> .<span class="dv">04</span>)) <span class="sc">*</span> <span class="fl">1.07</span>) </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>V4 <span class="ot">&lt;-</span> ((V3 <span class="sc">-</span> (V3 <span class="sc">*</span> .<span class="dv">04</span>)) <span class="sc">*</span> <span class="fl">1.07</span>) </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>V5 <span class="ot">&lt;-</span> ((V4 <span class="sc">-</span> (V4 <span class="sc">*</span> .<span class="dv">04</span>)) <span class="sc">*</span> <span class="fl">1.07</span>) </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>V6 <span class="ot">&lt;-</span> ((V5 <span class="sc">-</span> (V5 <span class="sc">*</span> .<span class="dv">04</span>)) <span class="sc">*</span> <span class="fl">1.07</span>) </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>V7 <span class="ot">&lt;-</span> ((V6 <span class="sc">-</span> (V6 <span class="sc">*</span> .<span class="dv">04</span>)) <span class="sc">*</span> <span class="fl">1.07</span>) </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>V8 <span class="ot">&lt;-</span> ((V7 <span class="sc">-</span> (V7 <span class="sc">*</span> .<span class="dv">04</span>)) <span class="sc">*</span> <span class="fl">1.07</span>) </span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>V9 <span class="ot">&lt;-</span> ((V8 <span class="sc">-</span> (V8 <span class="sc">*</span> .<span class="dv">04</span>)) <span class="sc">*</span> <span class="fl">1.07</span>) </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>V10 <span class="ot">&lt;-</span> ((V9 <span class="sc">-</span> (V9 <span class="sc">*</span> .<span class="dv">04</span>)) <span class="sc">*</span> <span class="fl">1.07</span>) </span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>V11 <span class="ot">&lt;-</span> ((V10 <span class="sc">-</span> (V10 <span class="sc">*</span> .<span class="dv">04</span>)) <span class="sc">*</span> <span class="fl">1.07</span>) </span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>V12 <span class="ot">&lt;-</span> ((V11 <span class="sc">-</span> (V11 <span class="sc">*</span> .<span class="dv">04</span>)) <span class="sc">*</span> <span class="fl">1.07</span>) </span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>V13 <span class="ot">&lt;-</span> ((V12 <span class="sc">-</span> (V12 <span class="sc">*</span> .<span class="dv">04</span>)) <span class="sc">*</span> <span class="fl">1.07</span>) </span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>V14 <span class="ot">&lt;-</span> ((V13 <span class="sc">-</span> (V13 <span class="sc">*</span> .<span class="dv">04</span>)) <span class="sc">*</span> <span class="fl">1.07</span>) </span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>V15 <span class="ot">&lt;-</span> ((V14 <span class="sc">-</span> (V14 <span class="sc">*</span> .<span class="dv">04</span>)) <span class="sc">*</span> <span class="fl">1.07</span>) </span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>V16 <span class="ot">&lt;-</span> ((V15 <span class="sc">-</span> (V15 <span class="sc">*</span> .<span class="dv">04</span>)) <span class="sc">*</span> <span class="fl">1.07</span>) </span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>V17 <span class="ot">&lt;-</span> ((V16 <span class="sc">-</span> (V16 <span class="sc">*</span> .<span class="dv">04</span>)) <span class="sc">*</span> <span class="fl">1.07</span>) </span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>V18 <span class="ot">&lt;-</span> ((V17 <span class="sc">-</span> (V17 <span class="sc">*</span> .<span class="dv">04</span>)) <span class="sc">*</span> <span class="fl">1.07</span>) </span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>V19 <span class="ot">&lt;-</span> ((V18 <span class="sc">-</span> (V18 <span class="sc">*</span> .<span class="dv">04</span>)) <span class="sc">*</span> <span class="fl">1.07</span>) </span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>V20 <span class="ot">&lt;-</span> ((V19 <span class="sc">-</span> (V19 <span class="sc">*</span> .<span class="dv">04</span>)) <span class="sc">*</span> <span class="fl">1.07</span>) </span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>V21 <span class="ot">&lt;-</span> ((V20 <span class="sc">-</span> (V20 <span class="sc">*</span> .<span class="dv">04</span>)) <span class="sc">*</span> <span class="fl">1.07</span>) </span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>V22 <span class="ot">&lt;-</span> ((V21 <span class="sc">-</span> (V21 <span class="sc">*</span> .<span class="dv">04</span>)) <span class="sc">*</span> <span class="fl">1.07</span>) </span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>V23 <span class="ot">&lt;-</span> ((V22 <span class="sc">-</span> (V22 <span class="sc">*</span> .<span class="dv">04</span>)) <span class="sc">*</span> <span class="fl">1.07</span>) </span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>V24 <span class="ot">&lt;-</span> ((V23 <span class="sc">-</span> (V23 <span class="sc">*</span> .<span class="dv">04</span>)) <span class="sc">*</span> <span class="fl">1.07</span>) </span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>V25 <span class="ot">&lt;-</span> ((V24 <span class="sc">-</span> (V24 <span class="sc">*</span> .<span class="dv">04</span>)) <span class="sc">*</span> <span class="fl">1.07</span>) </span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>V26 <span class="ot">&lt;-</span> ((V25 <span class="sc">-</span> (V25 <span class="sc">*</span> .<span class="dv">04</span>)) <span class="sc">*</span> <span class="fl">1.07</span>) </span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>V27 <span class="ot">&lt;-</span> ((V26 <span class="sc">-</span> (V26 <span class="sc">*</span> .<span class="dv">04</span>)) <span class="sc">*</span> <span class="fl">1.07</span>) </span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>V28 <span class="ot">&lt;-</span> ((V27 <span class="sc">-</span> (V27 <span class="sc">*</span> .<span class="dv">04</span>)) <span class="sc">*</span> <span class="fl">1.07</span>) </span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>V29 <span class="ot">&lt;-</span> ((V28 <span class="sc">-</span> (V28 <span class="sc">*</span> .<span class="dv">04</span>)) <span class="sc">*</span> <span class="fl">1.07</span>) </span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>V30 <span class="ot">&lt;-</span> ((V29 <span class="sc">-</span> (V29 <span class="sc">*</span> .<span class="dv">04</span>)) <span class="sc">*</span> <span class="fl">1.07</span>)</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>orp_calculation <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">Retirement_Year =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>),</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">Value =</span> <span class="fu">c</span>(V1, V2, V3, V4, V5, V6, V7, V8, V9, V10, V11, V12, V13, V14, V15, V16, V17, V18, V19, V20, V21, V22, V23, V24, V25, V26, V27, V28, V29, V30))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(orp_calculation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-8d738dc88c4e2df9b88d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-8d738dc88c4e2df9b88d">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30"],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],[177577.08624,176440.592888064,175311.3730935803,174189.3803057814,173074.5682718244,171966.8910348847,170866.3029322614,169772.7585934949,168686.2129384966,167606.6211756902,166533.9388001658,165468.1215918447,164409.1256136569,163356.9072097295,162311.4230035872,161272.6298963642,160240.4850650275,159214.9459606113,158195.9703064634,157183.516096502,156177.5415934844,155178.0053272861,154184.8660931915,153198.082950195,152217.6152193138,151243.4224819102,150275.4645780259,149313.7016047265,148358.0939144563,147408.6021134037]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Retirement_Year<\/th>\n      <th>Value<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Retirement_Year","targets":1},{"name":"Value","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>In this ORP calculation, I do not run out of funds. Since I have an increase about 7% a year due to a good stock market, my money only goes down about $30,000. In this calculation, the monthly average ranges from $500 to $1000, which is much less than the TRS plan. This is due to the differing stock market returns.</p>
<p>Thus, after passing away, you will still have $147,408.60 to give to your children.</p>
<p>Looking at the long term benefits, I believe that it would be more beneficial to go for TRS plan, as you will receive more money in the long run.</p>
</section>
</section>
<section id="monte-carlo-analysis" class="level1">
<h1>Monte Carlo Analysis</h1>
Below is the Monte Carlo Analysis.
<details>
<summary>
<strong>Click here to see how the Monte Carlo was calculated</strong>
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>monte_carlo <span class="ot">&lt;-</span> <span class="cf">function</span>(num_simulations, </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>                        starting_balance, </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                        monthly_trs_pension, </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>                        fixed_withdrawal_rate, </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>                        inflation_rate, </span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>                        market_return_data) {</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">simulation_id =</span> <span class="fu">numeric</span>(), </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">month =</span> <span class="fu">numeric</span>(), </span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">trs_income =</span> <span class="fu">numeric</span>(),</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">orp_income =</span> <span class="fu">numeric</span>(), </span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">orp_balance =</span> <span class="fu">numeric</span>())</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (sim <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_simulations) {</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(sim)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    sampled_returns <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">us_equity_return =</span> <span class="fu">sample</span>(market_return_data<span class="sc">$</span>us_equity_return, </span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>                                <span class="at">size =</span> <span class="fu">nrow</span>(market_return_data), </span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>                                <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    trs_income_stream <span class="ot">&lt;-</span> <span class="fu">simulate_trs</span>(</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">monthly_pension =</span> monthly_trs_pension,</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">retirement_years =</span> retirement_years,</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">inflation_rate =</span> inflation_rate)</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    orp_simulation <span class="ot">&lt;-</span> <span class="fu">simulate_orp</span>(</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">account_balance =</span> starting_balance,</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">retirement_years =</span> retirement_years,</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">fixed_withdrawal_rate =</span> fixed_withdrawal_rate,</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">market_return_rate =</span> sampled_returns<span class="sc">$</span>us_equity_return)</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>    orp_income_stream <span class="ot">&lt;-</span> orp_simulation<span class="sc">$</span>withdrawal</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>    orp_balance_stream <span class="ot">&lt;-</span> orp_simulation<span class="sc">$</span>balance</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> results <span class="sc">|&gt;</span></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(<span class="at">simulation_id =</span> sim,</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>                       <span class="at">month =</span> <span class="dv">1</span><span class="sc">:</span>(retirement_years <span class="sc">*</span> <span class="dv">12</span>),</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>                       <span class="at">trs_income =</span> trs_income_stream,</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>                       <span class="at">orp_income =</span> orp_income_stream,</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>                       <span class="at">orp_balance =</span> orp_balance_stream))}</span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results)}</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>simulate_trs <span class="ot">&lt;-</span> <span class="cf">function</span>(monthly_pension, </span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>                         retirement_years, </span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>                         inflation_rate) {</span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>  pension <span class="ot">&lt;-</span> <span class="fu">numeric</span>(retirement_years <span class="sc">*</span> <span class="dv">12</span>)</span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(pension)) {</span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>    inflation_adjustment <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(i <span class="sc">%%</span> <span class="dv">12</span> <span class="sc">==</span> <span class="dv">1</span>, </span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>                                   (<span class="dv">1</span> <span class="sc">+</span> inflation_rate) <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span>) {pension[i] <span class="ot">&lt;-</span> monthly_pension} </span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {pension[i] <span class="ot">&lt;-</span> pension[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> inflation_adjustment)}}</span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(pension)}</span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>simulate_orp <span class="ot">&lt;-</span> <span class="cf">function</span>(account_balance, </span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a>                         retirement_years, </span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a>                         fixed_withdrawal_rate, </span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a>                         market_return_rate) {</span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a>  withdrawal <span class="ot">&lt;-</span> <span class="fu">numeric</span>(retirement_years <span class="sc">*</span> <span class="dv">12</span>)</span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a>  balance <span class="ot">&lt;-</span> <span class="fu">numeric</span>(retirement_years <span class="sc">*</span> <span class="dv">12</span>)</span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(retirement_years <span class="sc">*</span> <span class="dv">12</span>)) {</span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a>    market_return <span class="ot">&lt;-</span> market_return_rate[i <span class="sc">%%</span> <span class="fu">length</span>(market_return_rate) <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a>    account_balance <span class="ot">&lt;-</span> account_balance <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> market_return)</span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a>    withdrawal_amount <span class="ot">&lt;-</span> account_balance <span class="sc">*</span> fixed_withdrawal_rate <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb24-61"><a href="#cb24-61" aria-hidden="true" tabindex="-1"></a>    withdrawal[i] <span class="ot">&lt;-</span> <span class="fu">min</span>(account_balance, withdrawal_amount)</span>
<span id="cb24-62"><a href="#cb24-62" aria-hidden="true" tabindex="-1"></a>    account_balance <span class="ot">&lt;-</span> account_balance <span class="sc">-</span> withdrawal[i]</span>
<span id="cb24-63"><a href="#cb24-63" aria-hidden="true" tabindex="-1"></a>    balance[i] <span class="ot">&lt;-</span> account_balance}</span>
<span id="cb24-64"><a href="#cb24-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">withdrawal =</span> withdrawal, <span class="at">balance =</span> balance))}</span>
<span id="cb24-65"><a href="#cb24-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-66"><a href="#cb24-66" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2024</span>)  </span>
<span id="cb24-67"><a href="#cb24-67" aria-hidden="true" tabindex="-1"></a>num_simulations <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb24-68"><a href="#cb24-68" aria-hidden="true" tabindex="-1"></a>starting_balance <span class="ot">&lt;-</span> <span class="dv">179000</span></span>
<span id="cb24-69"><a href="#cb24-69" aria-hidden="true" tabindex="-1"></a>monthly_trs_pension <span class="ot">&lt;-</span> <span class="dv">1987</span></span>
<span id="cb24-70"><a href="#cb24-70" aria-hidden="true" tabindex="-1"></a>fixed_withdrawal_rate <span class="ot">&lt;-</span> <span class="fl">0.04</span></span>
<span id="cb24-71"><a href="#cb24-71" aria-hidden="true" tabindex="-1"></a>inflation_rate <span class="ot">&lt;-</span> <span class="fl">0.15</span></span>
<span id="cb24-72"><a href="#cb24-72" aria-hidden="true" tabindex="-1"></a>retirement_years <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb24-73"><a href="#cb24-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-74"><a href="#cb24-74" aria-hidden="true" tabindex="-1"></a>market_return_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb24-75"><a href="#cb24-75" aria-hidden="true" tabindex="-1"></a>  <span class="at">us_equity_return =</span> <span class="fu">rnorm</span>(<span class="dv">360</span>, <span class="at">mean =</span> <span class="fl">0.05</span> <span class="sc">/</span> <span class="dv">12</span>, <span class="at">sd =</span> <span class="fl">0.06</span>))</span>
<span id="cb24-76"><a href="#cb24-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-77"><a href="#cb24-77" aria-hidden="true" tabindex="-1"></a>simulation_results <span class="ot">&lt;-</span> <span class="fu">monte_carlo</span> (</span>
<span id="cb24-78"><a href="#cb24-78" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_simulations =</span> num_simulations,</span>
<span id="cb24-79"><a href="#cb24-79" aria-hidden="true" tabindex="-1"></a>  <span class="at">starting_balance =</span> starting_balance,</span>
<span id="cb24-80"><a href="#cb24-80" aria-hidden="true" tabindex="-1"></a>  <span class="at">monthly_trs_pension =</span> monthly_trs_pension,</span>
<span id="cb24-81"><a href="#cb24-81" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed_withdrawal_rate =</span> fixed_withdrawal_rate,</span>
<span id="cb24-82"><a href="#cb24-82" aria-hidden="true" tabindex="-1"></a>  <span class="at">inflation_rate =</span> inflation_rate,</span>
<span id="cb24-83"><a href="#cb24-83" aria-hidden="true" tabindex="-1"></a>  <span class="at">market_return_data =</span> market_return_data)</span>
<span id="cb24-84"><a href="#cb24-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-85"><a href="#cb24-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-86"><a href="#cb24-86" aria-hidden="true" tabindex="-1"></a>orp_depletion_probability <span class="ot">&lt;-</span> simulation_results <span class="sc">%&gt;%</span></span>
<span id="cb24-87"><a href="#cb24-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(orp_balance <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-88"><a href="#cb24-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">prob =</span> <span class="fu">n_distinct</span>(simulation_id) <span class="sc">/</span> num_simulations) <span class="sc">%&gt;%</span></span>
<span id="cb24-89"><a href="#cb24-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(prob)</span>
<span id="cb24-90"><a href="#cb24-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-91"><a href="#cb24-91" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Probability of ORP funds depletion: "</span>, <span class="fu">round</span>(orp_depletion_probability <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Probability of ORP funds depletion:  0 %</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>orp_better_than_trs_probability <span class="ot">&lt;-</span> simulation_results <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(simulation_id) <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">orp_better =</span> <span class="fu">mean</span>(orp_income <span class="sc">&gt;</span> trs_income)) <span class="sc">%&gt;%</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">prob =</span> <span class="fu">mean</span>(orp_better <span class="sc">&gt;</span> <span class="fl">0.5</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(prob) </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Probability ORP income exceeds TRS income: "</span>, <span class="fu">round</span>(orp_better_than_trs_probability <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Probability ORP income exceeds TRS income:  0 %</code></pre>
</div>
</div>
</details>
<p>After completing this analysis, we can see that the probability of the ORP funds depleting before death is 0%. This matches up with our analysis from earlier, as we saw that by age 90, we still had about $140,000 left in our account.</p>
<p>We also can see that the probability of an ORP employee having a higher monthly income than a TRS employee is only 2.5%, which is quite low.</p>
<p>I would recommend more than a 4% withdrawal rate. Sticking with the 4%, there will be a lot of money left in your account after death and you will only be living on about $500 - $900 a month, which is unrealistic, especially in relation to the inflation rate increase.</p>
</section>
<section id="data-driven-decision-recommendation" class="level1">
<h1>Data-Driven Decision Recommendation</h1>
<p>Based on the Data, I believe that it is better to go with the TRS option for retirement. Overall, you will get more bang for your buck than the ORP, and can inevitably save money for your family after you pass. However, if you do choose to go with the ORP plan, there is very little risk. Both options are viable.</p>
<p>I did my analysis for an employee of less than 20 years. However, I believe if you compute an employee that worked longer, the results might differ. Nevertheless, I still believe that the TRS option is better, as it is the more stable one of the two.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/laurencardieri\.github\.io\/STA9750-2024-FALL\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>