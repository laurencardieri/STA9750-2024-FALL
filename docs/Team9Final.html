<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>team9final – STA 9750 2024 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 2024 Submission Material</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">




<section id="mortgages-whats-the-big-deal" class="level1" style="text-align: center;">
<h1>Mortgages: What’s the Big Deal</h1>
<p>By Lauren Cardieri, Maria Jerez, and Ayrat Aymetov</p>
<p><img src="https://www.pymnts.com/wp-content/uploads/2018/11/home-mortgage-alt-lending-bank-loans.jpg" class="img-fluid"> <strong>How does county, income, and demographics affect mortgage loans and rates through the three stages of Covid (2018 - 2023)?</strong></p>
</section>
<hr>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>To combat rising inflation, it is no secret that mortgage rates have been climbing continuously, even surging to the highest it has been in decades. While the current rates are not the highest, as in 1981 the rate for a 30-year fixed mortgage hit around 18.45%, our current rate of 7% - 8% is the highest it has been in recent years. Following the 2008 recession, mortgage rates hit a historic low of around 3% - 4%, dude to the Federal Reserve taking aggressive steps to stimulate the economy. This creates the question as to what happened within the last 16 years to cause this rise?</p>
<p>We figured that the Covid-19 pandemic could have played a factor, but we were unsure if this was causation, <em>or</em> correlation that does not imply causation. Thus, this is the reasoning we picked the five years of data that we did.</p>
<p>However, we also wanted to go on a more in-depth level. This is when we decided to see if income and demographics truly play a role in the mortgage rate bestowed upon you by the bank. We wanted to see if there was a true bias or if everyone was on the same playing field to begin. Choosing the geographic scale we wanted to asses our data on was difficult at first, as we originally intended to analyse this data on a borough level. After consideration, we realized we would have more data to draw conclusions basing our research on a New York State County level, which is the route we inevitably decided to go down.</p>
<p>Finally, we decided our goal; we wanted to dive into the shift of mortgages Pre, During, and Post Pandemic based on the following three metrics: Geography, Demographics, and Economics.</p>
</section>
<section id="data-sources" class="level2">
<h2 class="anchored" data-anchor-id="data-sources">Data Sources</h2>
<p>For our research, we decided on two major data sources to provide our information. They were the following:</p>
<ol type="1">
<li><a href="https://www.consumerfinance.gov/data-research/hmda/">Consumer Finance Protection Bureau- HMDA Data</a></li>
</ol>
<p>The Home Mortgage Disclosure Act allows for the data collection from financial institutions that disclose mortgage loan information. From this site, we retrieved the following data: year, interest rate, loan term, loan type, loan purpose, state code, county code, and much more.</p>
<ol start="2" type="1">
<li><a href="https://data.census.gov/profile/New_York?g=040XX00US36">United States Census Bureau</a></li>
</ol>
<p>The Census Bureau records data about people and its economy, and collects/records the data from a population. From this data, we retrieved data such as: income, employment, year, total income, industry, occupation, employment status, zip code, and much more.</p>
<p>We used two files to get the necessary data we needed:</p>
<ol type="1">
<li><p><a href="https://data.census.gov/table/ACSST5Y2022.S1901?q=Income%20by%20county&amp;g=040XX00US36,36$0500000">S1901 Income in the Past 12 Months (in 2022 Inflation-Adjusted Dollars)</a></p>
<ul>
<li>Income by household type: Family, Married, Nonfamily, etc.</li>
<li>Mean and Median income per household type</li>
<li>Estimate of how many people per $50,000 increments</li>
</ul></li>
<li><p><a href="https://data.census.gov/table/ACSST5Y2022.S2401?q=Employment%20by%20county&amp;g=040XX00US36,36$0500000">S2401Occupation by Sex for the Civilian Employed Population 16 Years and Over</a></p>
<ul>
<li>Total employment per county in New York</li>
<li>Gives the population of each job type</li>
</ul></li>
</ol>
</section>
<section id="analytical-stage-one" class="level2">
<h2 class="anchored" data-anchor-id="analytical-stage-one">Analytical Stage One</h2>
<p>To begin our analysis, we wanted to understand our data on a geographic level. Thus, we wanted to answer questions such as the following:</p>
<ol type="1">
<li>What is the mean income amount by county?</li>
<li>What is the total loan amount by county?</li>
<li>What are the main jobs/occupations by county?</li>
</ol>
<p>With these three questions in mind, we began our analysis. From it, the following four graphs were created.</p>
<section id="mean-income-amount-by-county" class="level3">
<h3 class="anchored" data-anchor-id="mean-income-amount-by-county">Mean Income Amount by County</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://postimg.cc/JtgZ29jD"><img src="https://i.postimg.cc/L64DnSXT/image.png" class="img-fluid figure-img" alt="image.png"></a></p>
<figcaption>image.png</figcaption>
</figure>
</div>
<p>Above is a graph we derived that shows the mean income by county. The green bars represent the three highest counties and the red represents the three lowest. It is clear that the three top counties did not change overtime. For the converse, the lowest counties did change, but they remained consistent.</p>
</section>
<section id="total-loan-amount-by-county" class="level3">
<h3 class="anchored" data-anchor-id="total-loan-amount-by-county">Total Loan Amount by County</h3>
<p><a href="https://postimg.cc/21dW3yMh"><img src="https://i.postimg.cc/T3FJ7Wc7/image.png" class="img-fluid"></a> Above is a graph that shows the total loan amount by county. Similar to the prior graph, the green and red bars represent the same ideas. Here, we can see that beside the first year of 2018, the highest counties remained the same. On the other hand, while the lowest counties did not remain the same, they remained consistent. It is also important to notice that the counties that have the highest income from the last graph tend to have a higher total loan amount on this graph. The same can also be said about the lowest counties.</p>
</section>
<section id="total-loan-types-overtime" class="level3">
<h3 class="anchored" data-anchor-id="total-loan-types-overtime">Total Loan Types Overtime</h3>
<p><a href="https://postimg.cc/HVrDp7Jv"><img src="https://i.postimg.cc/BQgqBTJ3/image.png" class="img-fluid"></a> In this graph, the four types of loans are compared over the years, with lines representing the total from every county. Here, it can be seen that loan type 1 is <em>by far</em> the most frequent loan type of the four. We can also see that after the height of Covid struck in 2021, each loan type experienced a drop, with loan type one experiencing the most dramatic drop.</p>
</section>
<section id="occupation-by-county" class="level3">
<h3 class="anchored" data-anchor-id="occupation-by-county">Occupation by County</h3>
<p><a href="https://postimg.cc/hzD1KTGX"><img src="https://i.postimg.cc/50v7qmdS/Occupations-graph.png" class="img-fluid"></a></p>
<p>Above is a graph we derived from our data to show occupation by county. Interestingly enough, we can see that the “Management, Business, Science, Arts” category <em>dominated</em> the four other categories in every single county.</p>
</section>
<section id="overall-stage-one-findings" class="level3">
<h3 class="anchored" data-anchor-id="overall-stage-one-findings">Overall Stage One Findings:</h3>
<ol type="1">
<li><p>Does the county you live in affect how much money you make?</p>
<p>Yes, the county you live in does affect how much you make, as some make progressively more than others</p></li>
<li><p>Does the mean income that a county makes correlate with the total amount of loans a county receives?</p>
<p>Yes, they do correlate. The counties that tended to have lower mean incomes, had less total loans. The ones that had a higher mean income, had more total loans.</p></li>
<li><p>Did any change occur with mean income and total loans before, during, and after COVID?</p>
<p>Mean income seemed to get higher after COVID in each county, while the Total Loans seemed to get lower. For both, the highest counties remained the same while the lowest counties varied throughout the years.</p></li>
<li><p>Was there a loan type that prevailed over the others, and did the total loans given change overtime?</p>
<p>Yes, Loan Type 1, Conventional Loans, was the highest in each county by far. After 2021, each loan type experienced a dramatic drop.</p></li>
<li><p>Was there a job category that prevailed in each county overtime?</p>
<p>Yes, the Management, Business, Science, Art category prevailed in each county overtime by far.</p></li>
</ol>
</section>
</section>
<section id="analytical-stage-two" class="level2">
<h2 class="anchored" data-anchor-id="analytical-stage-two">Analytical Stage Two</h2>
<p>Next, we wanted to understand our data on a demographic level. Thus, we wanted to answer questions such as the following:</p>
<ol type="1">
<li>What is the loan product types by race?</li>
<li>What is the total loan amount by race?<br>
</li>
<li>What is the average percentage interest rate by race?</li>
</ol>
<p>From these questions, the following graphs were created.</p>
<section id="loan-product-types-by-race" class="level3">
<h3 class="anchored" data-anchor-id="loan-product-types-by-race">Loan Product Types by Race</h3>
<p><a href="https://postimg.cc/Bj1CQJBG"><img src="https://i.postimg.cc/nh3S2zsM/image.png" class="img-fluid"></a></p>
<ol type="1">
<li><p>What loan Type is most popular among race? Does one benefit more than others?</p>
<p>Most popular loan = Conventional First Lien , White race benefits more.</p></li>
</ol>
</section>
<section id="total-loan-amount-by-race" class="level3">
<h3 class="anchored" data-anchor-id="total-loan-amount-by-race">Total Loan Amount by Race</h3>
<p><a href="https://postimg.cc/zyWnY0qz"><img src="https://i.postimg.cc/9Qg1TnS7/image.png" class="img-fluid"></a></p>
<ol start="2" type="1">
<li><p>Who has the greatest loan $ by race? Does one benefit more than others?</p>
<p>White, Asian, Black/African America, 2 or more minority race at bottom</p></li>
</ol>
</section>
<section id="average-percentage-interst-rate-by-race" class="level3">
<h3 class="anchored" data-anchor-id="average-percentage-interst-rate-by-race">Average Percentage Interst Rate by Race</h3>
<p><a href="https://postimg.cc/9Rx9YkYp"><img src="https://i.postimg.cc/rsT9MXdv/image.png" class="img-fluid"></a></p>
<ol start="3" type="1">
<li><p>What are the interest rates by race? Does one benefit more than the others?</p>
<p>Asian, White, Black/African American</p></li>
</ol>
</section>
<section id="average-income-distribution-by-race-thousand" class="level3">
<h3 class="anchored" data-anchor-id="average-income-distribution-by-race-thousand">Average Income Distribution by Race: Thousand $</h3>
<p><a href="https://postimg.cc/zymg7KK9"><img src="https://i.postimg.cc/Gmtxcj2h/image.png" class="img-fluid"></a></p>
<ol start="4" type="1">
<li><p>What are the average income distributions by race? Does one benefit more than the others?</p>
<p>Pre - 2 or more minority races highest average White, Asian, During White, Asian, Black/African American Post White, Asian, American Indian Alaskan Natives</p></li>
</ol>
</section>
</section>
<section id="analytical-stage-three" class="level2">
<h2 class="anchored" data-anchor-id="analytical-stage-three">Analytical Stage Three</h2>
<section id="income-and-mortgage-rates" class="level3">
<h3 class="anchored" data-anchor-id="income-and-mortgage-rates">Income and Mortgage Rates</h3>
<p><a href="https://postimg.cc/cr3KvC2T"><img src="https://i.postimg.cc/gkS3B6D9/image.png" class="img-fluid"></a></p>
<ol type="1">
<li><p>Are people with higher incomes more likely to get lower mortgage rates during the pandemic? Do higher incomes affect mortgage rates during the pandemic?</p>
<p>The graph shows that before the pandemic, high-income earners had slightly lower loan rates compared to other income groups, with lower-middle-income earners facing the highest rates. During the pandemic, rates dropped for all groups and became almost equal. Post-pandemic, rates for high, upper-middle, and low-income groups equalized, while lower-middle-income earners faced higher rates.</p></li>
</ol>
</section>
<section id="loan-approvals-in-new-york-state" class="level3">
<h3 class="anchored" data-anchor-id="loan-approvals-in-new-york-state">Loan Approvals in New York State</h3>
<p><a href="https://postimg.cc/QKTMKY4V"><img src="https://i.postimg.cc/vTPxjp57/image.png" class="img-fluid"></a></p>
<ol start="2" type="1">
<li><p>How did loan applications and approval rates vary across Pre-Pandemic, Pandemic, and Post-Pandemic periods?</p>
<p>The plot shows that post-pandemic, loan applications decreased to levels lower than pre-pandemic. During the pandemic, applications significantly increased, likely due to lower interest rates, while approval rates remained consistent across all three periods.</p></li>
</ol>
</section>
<section id="jobs-and-mortgages-rates-nyc-vs-state" class="level3">
<h3 class="anchored" data-anchor-id="jobs-and-mortgages-rates-nyc-vs-state">Jobs and Mortgages Rates, NYC vs State</h3>
<p><a href="https://postimg.cc/qNLvK3Lc"><img src="https://i.postimg.cc/vmRgp7xK/image.png" class="img-fluid"></a></p>
<p><a href="https://postimg.cc/jC7qX9cS"><img src="https://i.postimg.cc/7PBCxrT0/image.png" class="img-fluid"></a></p>
<ol start="3" type="1">
<li>Do certain jobs in a county affect mortgage rates during the pandemic?</li>
</ol>
<p>The plots reveal that: Loan rates between NYC and the rest of the state showed no significant differences during all three periods: pre-pandemic, pandemic, and post-pandemic - likely due to a comparable distribution of job types. Among NYC’s five boroughs, Manhattan consistently had the lowest loan rates during all three periods. This may be attributed to a higher proportion of Management, Business, Science, and Arts jobs in Manhattan compared to other boroughs.</p>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>The counties with the higher mean incomes tend to have more total loans while the lower incomes have less, proving income does affect the amount of mortgage loans given. The data confirms that White race, followed by Asian and then black/African American have greater mortgage loan types, loan $ and better rates. However there seems to be demand shifts throughout the three stages. More loans were given out during covid and has been decreasing after Covid.</p>
</section>
<section id="group-members" class="level2">
<h2 class="anchored" data-anchor-id="group-members">Group Members</h2>
<p><a href="https://postimg.cc/D8C2yTy5"><img src="https://i.postimg.cc/jSTCcqVV/image.png" class="img-fluid"></a></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/laurencardieri\.github\.io\/STA9750-2024-FALL\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>